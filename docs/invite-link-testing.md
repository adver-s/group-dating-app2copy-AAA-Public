# 招待リンク機能テストガイド

このドキュメントでは、招待リンク機能のテスト手順を説明します。

## 概要

招待リンク機能により、ユーザーは以下の方法で友達をグループに招待できます：

1. **招待リンク**: 長いURLで、ワンタップで参加可能
2. **招待コード**: 短い文字列で、メッセージアプリで簡単共有

## テスト手順

### 1. 自動テストの実行

```bash
# 招待リンク機能の自動テストを実行
npm run test:invite-link
```

このテストでは以下が実行されます：
- テストユーザーの作成
- テストチームの作成
- 招待リンクの生成
- 招待リンクからの参加シミュレーション
- マッチング候補表示のテスト

### 2. 手動テスト

#### 2.1 グループ作成と招待リンク生成

1. アプリケーションにアクセス: `http://localhost:3000`
2. ログインまたは新規登録
3. 「グループ作成」ページに移動
4. グループ情報を入力して作成
5. 作成後、招待リンクセクションで以下を確認：
   - 「招待リンクをコピー」ボタンが機能する
   - 「招待コードをコピー」ボタンが機能する
   - コピー成功時に通知が表示される

#### 2.2 招待リンクからの参加

1. 別のブラウザまたはシークレットモードで招待リンクにアクセス
2. グループ参加ページが表示されることを確認
3. 未ログインの場合、認証モーダルが表示されることを確認
4. ログイン後にグループに参加できることを確認
5. 参加後、グループ一覧に表示されることを確認

#### 2.3 招待コードからの参加

1. 招待コードを手動で入力
2. グループ参加ページにリダイレクトされることを確認
3. 上記の招待リンクと同様の参加フローが動作することを確認

### 3. マッチング機能のテスト

1. 複数のグループを作成（異なる性別設定）
2. マッチングページにアクセス
3. 他のグループが候補として表示されることを確認
4. スワイプ機能が正常に動作することを確認

## テストケース

### 正常系

- [ ] 招待リンクの生成
- [ ] 招待コードの生成
- [ ] 招待リンクからの参加
- [ ] 招待コードからの参加
- [ ] 未ログインユーザーの認証フロー
- [ ] 既存メンバーの重複参加防止
- [ ] 他のアクティブチーム所属者の参加制限

### 異常系

- [ ] 無効な招待リンクへのアクセス
- [ ] 存在しないチームIDでの参加試行
- [ ] 非アクティブチームへの参加試行
- [ ] 既にメンバーの場合の参加試行

## 期待される動作

### 招待リンク生成

```
✅ 招待リンクをコピーしました！
リンクを友達に送って、グループに招待しましょう！
```

### 招待リンクページ

- グループ名と説明が表示される
- ノリタグが表示される
- 利用可能時間が表示される
- 参加ボタンが機能する

### 参加成功

```
✅ グループに参加しました
```

### エラー処理

- 無効なリンク: 「グループが見つかりません」
- 既存メンバー: 「既にこのチームのメンバーです」
- 他のアクティブチーム所属: 「既に他のアクティブチームに所属しています」

## トラブルシューティング

### よくある問題

1. **招待リンクがコピーされない**
   - ブラウザの権限設定を確認
   - HTTPS環境でテスト（Clipboard APIの要件）

2. **参加ページが表示されない**
   - チームIDが正しいか確認
   - データベース接続を確認

3. **マッチング候補が表示されない**
   - チームの性別設定を確認
   - ターゲットジェンダーの設定を確認
   - チームがアクティブか確認

### デバッグ方法

```bash
# データベースの状態を確認
npx prisma studio

# ログを確認
tail -f logs/app.log

# テストデータをリセット
npm run test:invite-link
```

## 関連ファイル

- `app/teams/[id]/page.tsx` - チーム編集ページ（招待リンク生成）
- `app/teams/join/[teamId]/page.tsx` - 招待リンク参加ページ
- `app/api/teams/[id]/join/route.ts` - グループ参加API
- `scripts/test-invite-link.js` - 自動テストスクリプト

## 次のステップ

1. 招待リンク機能の動作確認
2. マッチングシステムのテスト
3. 合コン会議ページでのチーム表示確認
4. 実際のユーザーでの動作確認
